<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]<!--><html class="no-js" lang="en"><!--<![endif]--><head><meta charset="UTF-8" /><title>Notable Changes in RSpec 3</title><link href="/stylesheets/application.css" rel="stylesheet" type="text/css" /><link href="/stylesheets/normalize.css" rel="stylesheet" type="text/css" /><link href="/stylesheets/pages/blog.css" rel="stylesheet" type="text/css" /><link href="http://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" /><link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet" type="text/css" /><link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css" /><link href="/blog/feed.xml" rel="alternate" type="application/atom+xml" /></head><body class="blog"><header><nav><h1><a href="/">RSpec</a></h1><ul><li><a href="/about">About</a></li><li><a href="/documentation">Documentation</a></li><li><a href="/blog">Blog</a></li><li><a href="/upgrading-from-rspec-2">Upgrade</a></li><li><a href="/help">Get Help</a></li><li><a href="/contributing">Contributing</a></li></ul></nav></header><section><article class="blog_post"><h1>Notable Changes in RSpec 3</h1><h3 class="author">Myron Marston</h3><small class="date">May 21, 2014</small><p>Update: there's a <a href="http://nilp.hatenablog.com/entry/2014/05/28/003335">Japanese
translation</a> of this
available now.</p>

<p>RSpec 3.0.0 RC1 was <a href="/blog/2014/05/rspec-2-99-and-3-0-rc-1-have-been-released">released a couple days
ago</a>,
and 3.0.0 final is just around the corner.  We've been using the betas for the
last 6 months and we're excited to share them with you. Here's whats new:</p>

<h2 id="across-all-gems">Across all gems</h2>

<h3 id="removed-support-for-ruby-186-and-191">Removed support for Ruby 1.8.6 and 1.9.1</h3>

<p>These versions of Ruby were end-of-lifed long ago and
RSpec 3 does not support them.</p>

<h3 id="improved-ruby-2x-support">Improved Ruby 2.x support</h3>

<p>Recent releases of RSpec 2.x (i.e. those that came out after
Ruby 2.0 was released) have officially supported Ruby 2, but RSpec 3's
support is greatly improved. We now provide support for working
with the new features of Ruby 2, like keyword arguments and prepended
modules.</p>

<h3 id="new-rspec-support-gem">New rspec-support gem</h3>

<p><a href="https://github.com/rspec/rspec-support">rspec-support</a> is a new gem
that we're using for common code needed by more than one of
rspec-(core|expectations|mocks|rails). It doesn't currently contain
any public APIs intended for use by end users or extension library
authors, but we may make some of its APIs public in the future.</p>

<p>If you run bleeding-edge RSpec by sourcing it from github in your
Gemfile, you'll need to start doing the same for rspec-support as well.</p>

<h3 id="robust-well-tested-upgrade-process">Robust, well-tested upgrade process</h3>

<p>Every breaking change in RSpec 3 has a corresponding deprecation warning in 2.99.
Throughout the betas we have done many upgrades to ensure this process is as
smooth as possible. We've put together <a href="https://relishapp.com/rspec/docs/upgrade">step by step upgrade
instructions</a>.</p>

<p>The upgrade process also highlights RSpec's new deprecation system
which is highly configurable (allowing you to output deprecations
into a file or turn all deprecations into errors) and is designed
to minimize duplicated deprecation output.</p>

<h3 id="improved-docs">Improved Docs</h3>

<p>We've put a ton of effort into updating the API docs for all gems.
They're currently hosted on <a href="http://rubydoc.info/">rubydoc.info</a>:</p>

<ul>
  <li><a href="http://rubydoc.info/github/rspec/rspec-core/frames">rspec-core</a></li>
  <li><a href="http://rubydoc.info/github/rspec/rspec-expectations/frames">rspec-expectations</a></li>
  <li><a href="http://rubydoc.info/github/rspec/rspec-mocks/frames">rspec-mocks</a></li>
  <li><a href="http://rubydoc.info/github/rspec/rspec-rails/frames">rspec-rails</a></li>
</ul>

<p>…but we're currently working on updating <a href="http://rspec.info/">rspec.info</a>
to self-host them.</p>

<p>While the docs are still a work-in-progress (and frankly, always will be),
we've made sure to explicitly declare all public APIs as part of
<a href="http://semver.org/">SemVer</a> compliance. We're absolutely committed to
maintaining all public APIs through all 3.x releases. Private APIs, on
the other hand, are labeled as such because we specifically want to
reserve the flexibility to change them willy nilly in any 3.x release.</p>

<p>Please do not use APIs we've declared private. If you find yourself
with a need not addressed by the existing public APIs, please ask.
We'll gladly either make a private API public for your needs
or add a new API to meet your use case.</p>

<h3 id="gems-are-now-signed">Gems are now signed</h3>

<p>We've started signing our gem releases. While the current gem signing
system is far from ideal, and <a href="http://corner.squareup.com/2013/12/securing-rubygems-with-tuf-part-1.html">a better
solution</a>
is being developed, it's better than nothing. We've put our public cert on
<a href="https://github.com/rspec/rspec/blob/master/certs/rspec.pem">GitHub</a>.</p>

<p>For more details on the current gem signing system, see <a href="http://blog.meldium.com/home/2013/3/3/signed-rubygems-part">A Practical
Guide to Using Signed Ruby
Gems</a>.</p>

<h3 id="zero-monkey-patching-mode">Zero monkey patching mode</h3>

<p>RSpec can now be used without any monkey patching whatsoever.
Much of the groundwork for this was laid in recent 2.x releases
that added the new <code>expect</code>-based syntax to rspec-expectations
and rspec-mocks. We've gone the rest of the way in RSpec 3 and
provided alternatives for the remaining monkey patches.</p>

<p>For convenience you can disable all of the monkey patches with one option:</p>

<pre class="highlight ruby"><code><span class="c1"># spec/spec_helper.rb</span>
<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
  <span class="n">c</span><span class="p">.</span><span class="nf">disable_monkey_patching!</span>
<span class="k">end</span>
</code></pre>

<p>Thanks to <a href="https://github.com/waterlink">Alexey Fedorov</a> for
<a href="https://github.com/rspec/rspec-core/pull/1465">implementing</a> this config option.</p>

<p>For more info:</p>

<ul>
  <li><a href="http://rubydoc.info/github/rspec/rspec-core/RSpec/Core/Configuration#disable_monkey_patching%21-instance_method">Documentation</a></li>
</ul>

<h2 id="rspec-core">rspec-core</h2>

<h3 id="new-names-for-hook-scopes-example-and-context">New names for hook scopes: <code>:example</code> and <code>:context</code></h3>

<p>RSpec 2.x had three different hook scopes:</p>

<pre class="highlight ruby"><code><span class="n">describe</span> <span class="no">MyClass</span> <span class="k">do</span>
  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span> <span class="c1"># runs before each example in this group</span>
  <span class="n">before</span><span class="p">(</span><span class="ss">:all</span><span class="p">)</span>  <span class="p">{</span> <span class="p">}</span> <span class="c1"># runs once before the first example in this group</span>
<span class="k">end</span>
</code></pre>

<pre class="highlight ruby"><code><span class="c1"># spec/spec_helper.rb</span>
<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
  <span class="n">c</span><span class="p">.</span><span class="nf">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span>  <span class="p">{</span> <span class="p">}</span> <span class="c1"># runs before each example in the entire test suite</span>
  <span class="n">c</span><span class="p">.</span><span class="nf">before</span><span class="p">(</span><span class="ss">:all</span><span class="p">)</span>   <span class="p">{</span> <span class="p">}</span> <span class="c1"># runs before the first example of each top-level group</span>
  <span class="n">c</span><span class="p">.</span><span class="nf">before</span><span class="p">(</span><span class="ss">:suite</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span> <span class="c1"># runs once after all spec files have been loaded, before the first spec runs</span>
<span class="k">end</span>
</code></pre>

<p>At times, users have expressed confusion around what <code>:each</code> vs <code>:all</code>
means, and <code>:all</code> in particular can be confusing when you use it in a
config block:</p>

<pre class="highlight ruby"><code><span class="c1"># spec/spec_helper.rb</span>
<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
  <span class="n">c</span><span class="p">.</span><span class="nf">before</span><span class="p">(</span><span class="ss">:all</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>

<p>In this context, the term <code>:all</code> suggests that this hook will run once
before all examples in the suite — but that is what <code>:suite</code> is for.</p>

<p>In RSpec 3, <code>:each</code> and <code>:all</code> have aliases that make their scope
more explicit: <code>:example</code> is an alias of <code>:each</code> and <code>:context</code>
is an alias of <code>:all</code>. Note that <code>:each</code> and <code>:all</code> are <em>not</em> deprecated
and we have no plans to do so.</p>

<p>Thanks to <a href="https://github.com/fj">John Feminella</a> for
<a href="https://github.com/rspec/rspec-core/pull/1174">implementing</a> this.</p>

<p>For more info:</p>

<ul>
  <li><a href="http://rubydoc.info/github/rspec/rspec-core/RSpec/Core/Hooks#before-instance_method">Documentation</a></li>
  <li><a href="https://github.com/rspec/rspec-core/pull/297">rspec-core #297 - original discussion</a></li>
</ul>

<h3 id="dsl-methods-yield-the-example-as-an-argument">DSL methods yield the example as an argument</h3>

<p><code>RSpec::Core::Example</code> provides access to all the details about an
example: its description, location, metadata, execution result, etc.
In RSpec 2.x the example was exposed via an <code>example</code> method that could
be accessed from any hook or individual example:</p>

<pre class="highlight ruby"><code><span class="n">describe</span> <span class="no">MyClass</span> <span class="k">do</span>
  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="p">{</span> <span class="nb">puts</span> <span class="n">example</span><span class="p">.</span><span class="nf">metadata</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>

<p>In RSpec 3, we've removed the <code>example</code> method. Instead, the example
instance is yielded to all example-scoped DSL methods as an explicit
argument:</p>

<pre class="highlight ruby"><code><span class="n">describe</span> <span class="no">MyClass</span> <span class="k">do</span>
  <span class="n">before</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">ex</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">ex</span><span class="p">.</span><span class="nf">metadata</span> <span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:example_description</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">ex</span><span class="o">|</span> <span class="n">ex</span><span class="p">.</span><span class="nf">description</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'accesses the example'</span> <span class="k">do</span> <span class="o">|</span><span class="n">ex</span><span class="o">|</span>
    <span class="c1"># use ex</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>Thanks to <a href="https://github.com/dchelimsky">David Chelimsky</a> for coming up
with the idea and
<a href="https://github.com/rspec/rspec-core/pull/666">implementing</a> it!</p>

<p>For more info:</p>

<ul>
  <li><a href="http://rubydoc.info/github/rspec/rspec-core/RSpec/Core/Example">Documentation</a></li>
</ul>

<h3 id="new-exposedslglobally-config-option-to-disable-rspec-core-monkey-patching">New <code>expose_dsl_globally</code> config option to disable rspec-core monkey patching</h3>

<p>RSpec 2.x monkey patched <code>main</code> and <code>Module</code> to provide top level
methods like <code>describe</code>, <code>shared_examples_for</code> and <code>shared_context</code>:</p>

<pre class="highlight ruby"><code><span class="n">shared_examples_for</span> <span class="s2">"something"</span> <span class="k">do</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nn">MyGem</span>
  <span class="n">describe</span> <span class="no">SomeClass</span> <span class="k">do</span>
    <span class="n">it_behaves_like</span> <span class="s2">"something"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>In RSpec 3, these methods are now also available on the <code>RSpec</code> module
(in addition to still being available as monkey patches):</p>

<pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">shared_examples_for</span> <span class="s2">"something"</span> <span class="k">do</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nn">MyGem</span>
  <span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">SomeClass</span> <span class="k">do</span>
    <span class="n">it_behaves_like</span> <span class="s2">"something"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>You can completely remove rspec-core's monkey patching (which
would make the first example above raise <code>NoMethodError</code>) by
setting the new <code>expose_dsl_globally</code> config option to <code>false</code>:</p>

<pre class="highlight ruby"><code><span class="c1"># spec/spec_helper.rb</span>
<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">expose_dsl_globally</span> <span class="o">=</span> <span class="kp">false</span>
<span class="k">end</span>
</code></pre>

<p>Thanks to <a href="https://github.com/JonRowe">Jon Rowe</a> for
<a href="https://github.com/rspec/rspec-core/pull/1036">implementing</a> this.</p>

<p>For more info:</p>

<ul>
  <li><a href="https://relishapp.com/rspec/rspec-core/v/3-0/docs/configuration/global-namespace-dsl">Documentation</a></li>
</ul>

<h3 id="define-example-group-aliases-with-aliasexamplegroupto">Define example group aliases with <code>alias_example_group_to</code></h3>

<p>In RSpec 2.x, we provided an API that allowed you to define <code>example</code>
aliases with attached metadata. For example, this is used internally to
define <code>fit</code> as an alias for <code>it</code> with <code>:focus =&gt; true</code> metadata:</p>

<pre class="highlight ruby"><code><span class="c1"># spec/spec_helper.rb</span>
<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">alias_example_to</span> <span class="ss">:fit</span><span class="p">,</span> <span class="ss">:focus</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>
</code></pre>

<p>In RSpec 3, we've extended this feature to example groups:</p>

<pre class="highlight ruby"><code><span class="c1"># spec/spec_helper.rb</span>
<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">alias_example_group_to</span> <span class="ss">:describe_model</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:model</span>
<span class="k">end</span>
</code></pre>

<p>You could use this example in a project using rspec-rails and use
<code>describe_model User</code> rather than <code>describe User, :type =&gt; :model</code>.</p>

<p>Thanks to <a href="https://github.com/michihuber">Michi Huber</a> for
<a href="https://github.com/rspec/rspec-core/pull/1236">implementing</a> this.</p>

<p>For more info:</p>

<ul>
  <li><a href="http://rubydoc.info/github/rspec/rspec-core/RSpec/Core/Configuration#alias_example_group_to-instance_method">Documentation</a></li>
  <li><a href="https://github.com/rspec/rspec-core/issues/493">rspec-core #493 - original discussion</a></li>
</ul>

<h3 id="new-example-group-aliases-xdescribe-xcontext-fdescribe-fcontext">New example group aliases: <code>xdescribe</code>, <code>xcontext</code>, <code>fdescribe</code>, <code>fcontext</code></h3>

<p>Besides including an API to define example group aliases, we've also
included several additional built-in aliases (on top of <code>describe</code> and
<code>context</code>):</p>

<ul>
  <li><code>xdescribe</code>/<code>xcontext</code>, like <code>xit</code> for examples, can be used to temporarily skip an
example group.</li>
  <li><code>fdescribe</code>/<code>fcontext</code>, like <code>fit</code> for examples, can be used to temporarily add
<code>:focus =&gt; true</code> metadata to an example group so that you can easily
filter to the focused examples and groups via <code>config.filter_run :focus</code>.</li>
</ul>

<p>For more info:</p>

<ul>
  <li><a href="http://rubydoc.info/github/rspec/rspec-core/RSpec/Core/ExampleGroup">Documentation</a></li>
  <li><a href="https://github.com/rspec/rspec-core/pull/1255">rspec-core #1255 - implementation</a></li>
</ul>

<h3 id="changes-to-pending-semantics-and-introduction-of-skip">Changes to <code>pending</code> semantics (and introduction of <code>skip</code>)</h3>

<p>Pending examples are now run to check if they are actually passing. If
a pending block fails, then it will be marked pending as before. However, if
it succeeds it will cause a failure. This helps ensure that pending examples are
valid, and also that they are promptly dealt with when the behaviour they
describe is implemented.</p>

<p>To support the old "never run" behaviour, the <code>skip</code> method and metadata has
been added. None of the following examples will ever be run:</p>

<pre class="highlight ruby"><code><span class="n">describe</span> <span class="no">Post</span> <span class="k">do</span>
  <span class="n">skip</span> <span class="s1">'not implemented yet'</span> <span class="k">do</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'does something'</span><span class="p">,</span> <span class="ss">:skip</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="k">do</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'does something'</span><span class="p">,</span> <span class="ss">:skip</span> <span class="o">=&gt;</span> <span class="s1">'reason explanation'</span> <span class="k">do</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'does something else'</span> <span class="k">do</span>
    <span class="n">skip</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'does something else'</span> <span class="k">do</span>
    <span class="n">skip</span> <span class="s1">'reason explanation'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>With this change, passing a block to <code>pending</code> within an example no longer
makes sense, so that behaviour has been removed.</p>

<p>Thanks to <a href="http://xaviershay.com">Xavier Shay</a> for
<a href="https://github.com/rspec/rspec-core/pull/1267">implementing</a> this.</p>

<p>For more info:</p>

<ul>
  <li><a href="https://relishapp.com/rspec/rspec-core/v/3-0/docs/pending-and-skipped-examples">Documentation</a></li>
  <li><a href="https://github.com/rspec/rspec-core/issues/1208">rspec-core #1208 - original discussion</a></li>
</ul>

<h3 id="new-api-for-one-liners-isexpected">New API for one-liners: <code>is_expected</code></h3>

<p>RSpec has had a one-liner syntax for many years:</p>

<pre class="highlight ruby"><code><span class="n">describe</span> <span class="no">Post</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">allow_mass_assignment_of</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>

<p>In this context, <code>should</code> is <em>not</em> the monkey-patched <code>should</code>
that can be removed by configuring rspec-expectations to only
support the <code>:expect</code> syntax. It doesn't have the baggage that
monkey-patching <code>Object</code> with <code>should</code> brings, and is always
available regardless of your syntax configuration.</p>

<p>Some users have expressed confusion about how this <code>should</code> relates
to the <code>expect</code> syntax and if you can continue using it. It will continue
to be available in RSpec 3 (again, regardless of your syntax configuration),
but we've also added an alternate API that is a bit more consistent with
the <code>expect</code> syntax:</p>

<pre class="highlight ruby"><code><span class="n">describe</span> <span class="no">Post</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">is_expected</span><span class="p">.</span><span class="nf">to</span> <span class="n">allow_mass_assignment_of</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>

<p><code>is_expected</code> is defined very simply as <code>expect(subject)</code> and also
supports negative expectations via <code>is_expected.not_to matcher</code>.</p>

<p>For more info:</p>

<ul>
  <li><a href="http://rubydoc.info/github/rspec/rspec-core/RSpec/Core/MemoizedHelpers#is_expected-instance_method">Documentation</a></li>
  <li><a href="https://github.com/rspec/rspec-core/pull/1180">rspec-core #1180 - implementation</a></li>
</ul>

<h3 id="example-groups-can-be-ordered-individually">Example groups can be ordered individually</h3>

<p>RSpec 2.8 introduced random ordering to RSpec, which is very useful for
surfacing unintentional ordering dependencies in your spec suite. In
RSpec 3, it's no longer an all-or-nothing feature. You can control how
individual example groups are ordered by tagging them with appropriate
metadata:</p>

<pre class="highlight ruby"><code><span class="n">describe</span> <span class="no">MyClass</span><span class="p">,</span> <span class="ss">:order</span> <span class="o">=&gt;</span> <span class="ss">:defined</span> <span class="k">do</span>
  <span class="c1"># examples in this group will always run in defined order,</span>
  <span class="c1"># regardless of any other ordering configuration.</span>
<span class="k">end</span>

<span class="n">describe</span> <span class="no">MyClass</span><span class="p">,</span> <span class="ss">:order</span> <span class="o">=&gt;</span> <span class="ss">:random</span> <span class="k">do</span>
  <span class="c1"># examples in this group will always run in random order,</span>
  <span class="c1"># regardless of any other ordering configuration.</span>
<span class="k">end</span>
</code></pre>

<p>This is particularly useful for migrating from defined to random
ordering, as it allows you to deal with ordering dependencies one-by-one
as you opt-in to the feature for particular groups rather than
having to solve the issues all at once.</p>

<p>As part of this we've also renamed <code>--order default</code> to <code>--order
defined</code>, because we realized that "default" was a highly overloaded
term.</p>

<p>Thanks to <a href="https://github.com/alindeman">Andy Lindeman</a> and <a href="https://github.com/samphippen">Sam
Phippen</a> for helping
<a href="https://github.com/rspec/rspec-core/pull/1025">implement</a> this feature.</p>

<p>For more info:</p>

<ul>
  <li><a href="http://rubydoc.info/github/rspec/rspec-core/RSpec/Core/Configuration#register_ordering-instance_method">Documentation</a></li>
</ul>

<h3 id="new-ordering-strategy-api">New ordering strategy API</h3>

<p>In RSpec 3, we've overhauled the ordering strategy API. What used to be
<a href="http://rubydoc.info/gems/rspec-core/2.14.8/RSpec/Core/Configuration:order_examples">three</a>
<a href="http://rubydoc.info/gems/rspec-core/2.14.8/RSpec/Core/Configuration:order_groups">different</a>
<a href="http://rubydoc.info/gems/rspec-core/2.14.8/RSpec/Core/Configuration:order_groups_and_examples">methods</a>
is now one method: <code>register_ordering</code>. Use it to define a named ordering
strategy:</p>

<pre class="highlight ruby"><code><span class="c1"># spec/spec_helper.rb</span>
<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">register_ordering</span><span class="p">(</span><span class="ss">:description_length</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">list</span><span class="o">|</span>
    <span class="n">list</span><span class="p">.</span><span class="nf">sort_by</span> <span class="p">{</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span> <span class="n">item</span><span class="p">.</span><span class="nf">description</span><span class="p">.</span><span class="nf">length</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<pre class="highlight ruby"><code><span class="n">describe</span> <span class="no">MyClass</span><span class="p">,</span> <span class="ss">:order</span> <span class="o">=&gt;</span> <span class="ss">:description_length</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>

<p>Or, you can use it to define the global ordering:</p>

<pre class="highlight ruby"><code><span class="c1"># spec/spec_helper.rb</span>
<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">register_ordering</span><span class="p">(</span><span class="ss">:global</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">list</span><span class="o">|</span>
    <span class="c1"># sort them alphabetically</span>
    <span class="n">list</span><span class="p">.</span><span class="nf">sort_by</span> <span class="p">{</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span> <span class="n">item</span><span class="p">.</span><span class="nf">description</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>The <code>:global</code> ordering is used to order the top-level example groups
and to order all example groups that do not have <code>:order</code> metadata.</p>

<p>For more info:</p>

<ul>
  <li><a href="http://rubydoc.info/github/rspec/rspec-core/RSpec/Core/Configuration#register_ordering-instance_method">Documentation</a></li>
  <li><a href="https://github.com/rspec/rspec-core/pull/1025">rspec-core #1025 - implementation</a></li>
</ul>

<h3 id="rspec---init-improvements"><code>rspec --init</code> improvements</h3>

<p>The <code>rspec</code> command has provided the <code>--init</code> option to setup a project
skeleton for a long time. In RSpec 3, the files it produces have been
greatly improved to provide a better out-of-the-box experience and
to provide a <code>spec/spec_helper.rb</code> file with more recommended settings.</p>

<p>Note that recommended settings which are not slated to become future
defaults are commented out in the generated file, so it's a good idea
to open the file and accept the recommendations you want.</p>

<p>For more info:</p>

<ul>
  <li><a href="https://github.com/rspec/rspec-core/pull/1219">rspec-core #1219 - implementation</a></li>
</ul>

<h3 id="new---dry-run-cli-option">New <code>--dry-run</code> CLI option</h3>

<p>This option will print the formatter output of your spec suite
without running any of the examples or hooks. It's particularly
useful as way to review your suite's documentation output without
waiting for your specs to run or worrying about their pass/fail
status.</p>

<p>Thanks to <a href="https://github.com/schnittchen">Thomas Stratmann</a> for
<a href="https://github.com/rspec/rspec-core/pull/1028">contributing</a> this!</p>

<p>For more info:</p>

<ul>
  <li><a href="https://relishapp.com/rspec/rspec-core/v/3-0/docs/command-line/dry-run-option">Documentation</a></li>
  <li><a href="https://github.com/rspec/rspec-core/issues/1022">rspec-core #1022 - original discussion</a></li>
</ul>

<h3 id="formatter-api-changes">Formatter API changes</h3>

<p>A completely new formatter API has been added that is much more flexible.</p>

<ul>
  <li>Subscribe only to the events you care about.</li>
  <li>Methods receive notification objects rather than specific parameters,
so new notification data can be added in a backwards compatible manner.</li>
  <li>Helper methods are exposed on notification objects such that inheriting
from <code>BaseTextFormatter</code> is no longer effectively necessary.</li>
</ul>

<p>A new formatters looks like this:</p>

<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">CustomFormatter</span>
  <span class="nc">RSpec</span><span class="o">::</span><span class="no">Core</span><span class="o">::</span><span class="no">Formatters</span><span class="p">.</span><span class="nf">register</span> <span class="nb">self</span><span class="p">,</span> <span class="ss">:example_started</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="vi">@output</span> <span class="o">=</span> <span class="n">output</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">example_started</span><span class="p">(</span><span class="n">notification</span><span class="p">)</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">"example: "</span> <span class="o">&lt;&lt;</span> <span class="n">notification</span><span class="p">.</span><span class="nf">example</span><span class="p">.</span><span class="nf">description</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>The <a href="https://github.com/rspec/rspec-legacy_formatters">rspec-legacy_formatters
gem</a> is provided to continue
to support the old 2.x formatter API.</p>

<p>Thanks to <a href="https://github.com/JonRowe">Jon Rowe</a> for taking charge of
this.</p>

<p>For more info:</p>

<ul>
  <li><a href="https://github.com/tpope/fivemat/blob/3f4f550fa2852a34a020d31d834a7a3f0210b1ca/lib/fivemat/rspec3.rb">Fivemat's RSpec 3 formatter (example of a full formatter implemenation)</a></li>
</ul>

<h3 id="assertion-config-changes">Assertion config changes</h3>

<p>While most users use rspec-expectations, it's trivial to use something
else and RSpec 2.x made the most common alternate easily available via
a config option:</p>

<pre class="highlight ruby"><code><span class="c1"># spec/spec_helper.rb</span>
<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">expect_with</span> <span class="ss">:stdlib</span>
  <span class="c1"># or, to use both:</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">expect_with</span> <span class="ss">:stdlib</span><span class="p">,</span> <span class="ss">:rspec</span>
<span class="k">end</span>
</code></pre>

<p>However, there's been confusion around <code>:stdlib</code>. On Ruby 1.8, the
standard lib assertion module is <code>Test::Unit::Assertions</code>. On 1.9+ it's
a thin wrapper over <code>Minitest::Assertions</code> (and you're generally better
off using just that).  Meanwhile, there's also a test-unit gem
that defines <code>Test::Unit::Assertions</code> (which is <em>not</em> a wrapper over
minitest) and a minitest gem.</p>

<p>For RSpec 3, we've removed <code>expect_with :stdlib</code> and instead opted
for explicit <code>:test_unit</code> and <code>:minitest</code> options:</p>

<pre class="highlight ruby"><code><span class="c1"># spec/spec_helper.rb</span>
<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="c1"># for test-unit:</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">expect_with</span> <span class="ss">:test_unit</span>

  <span class="c1"># for minitest:</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">expect_with</span> <span class="ss">:minitest</span>
<span class="k">end</span>
</code></pre>

<p>Thanks to <a href="http://aaronkromer.com/">Aaron Kromer</a> for <a href="https://github.com/rspec/rspec-core/pull/1466">implementing
this</a>.</p>

<p>For more info:</p>

<ul>
  <li><a href="http://rubydoc.info/github/rspec/rspec-core/RSpec/Core/Configuration#expect_with-instance_method">Documentation</a></li>
</ul>

<h3 id="define-derived-metadata">Define derived metadata</h3>

<p>RSpec's metadata system is extremely flexible, allowing you to slice and
dice your test suite in many ways. There's a new config API that allows
you to define derived metadata. For example, to automatically tag all
example groups in <code>spec/acceptance/js</code> with <code>:js =&gt; true</code>:</p>

<pre class="highlight ruby"><code><span class="c1"># spec/spec_helper.rb</span>
<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">define_derived_metadata</span><span class="p">(</span><span class="ss">:file_path</span> <span class="o">=&gt;</span> <span class="sr">%r{/spec/acceptance/js/}</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">metadata</span><span class="o">|</span>
    <span class="n">metadata</span><span class="p">[</span><span class="ss">:js</span><span class="p">]</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>For more info:</p>

<ul>
  <li><a href="http://rubydoc.info/github/rspec/rspec-core/RSpec/Core/Configuration#define_derived_metadata-instance_method">Documentation</a></li>
  <li><a href="https://github.com/rspec/rspec-core/pull/1496">rspec-core #1496 - implementation</a></li>
  <li><a href="https://github.com/rspec/rspec-core/issues/969">rspec-core #969 - original discussion</a></li>
</ul>

<h3 id="removals">Removals</h3>

<p>Several things that are no longer core to RSpec have either been removed
entirely or extracted into an external gem:</p>

<ul>
  <li>The Textmate formatter has been moved into the <a href="https://github.com/rspec/rspec-tmbundle">Textmate
bundle</a>.
Having a formatter for one specific text editor in rspec-core doesn't
really make sense.</li>
  <li>RCov integration has been dropped. It was never updated to work with
1.9+ and these days we recommend using
<a href="https://github.com/colszowka/simplecov">simplecov</a> instead.</li>
  <li>The <code>--debug</code> CLI option has been removed. These days there are many
different debugger options, and you can activate them from the command
line using the <code>--require</code> (or <code>-r</code>) option. For example, to use
<a href="https://github.com/deivid-rodriguez/byebug">byebug</a>, pass <code>-rbyebug</code>
at the command line.</li>
  <li>We've removed the <code>--line-number</code> CLI option. It had dubious semantics
to begin with (<code>--line-number 43</code> would filter to the example defined
near line 43 in every loaded spec file, but there's no reason line 43 in
each file would be related), and duplicates the more terse
<code>path/to/spec.rb:43</code> form.</li>
  <li><code>its</code> has been extracted into the new
<a href="https://github.com/rspec/rspec-its">rspec-its</a> gem, which
<a href="https://github.com/palfvin">Peter Alfvin</a> has kindly offered to maintain.</li>
  <li>Autotest integration has been extracted into the new new
<a href="https://github.com/rspec/rspec-autotest">rspec-autotest</a> gem (which
could use a maintainer: any volunteers?).</li>
</ul>

<h2 id="rspec-expectations">rspec-expectations</h2>

<h3 id="using-should-syntax-without-explicitly-enabling-it-is-deprecated">Using <code>should</code> syntax without explicitly enabling it is deprecated</h3>

<p>In RSpec 2.11 we started the move towards eliminating monkey patching
from RSpec by <a href="/blog/2012/06/rspecs-new-expectation-syntax">introducing a new expect-based
syntax</a>.
In RSpec 3, we've kept the <code>should</code> syntax, and it is available by
default, but you will get a deprecation warning if you use it without
explicitly enabling it. This will pave the way for it being disabled
by default (or potentially extracted into a seperate gem) in RSpec 4,
while minimizing confusion for newcomers coming to RSpec via an old tutorial.</p>

<p>We consider the <code>expect</code> syntax to be the "main" syntax of RSpec now,
but if you prefer the older <code>should</code>-based syntax, feel free to keep using it:
we have no plans to ever kill it.</p>

<p>Thanks to <a href="https://github.com/samphippen">Sam Phippen</a> for
<a href="https://github.com/rspec/rspec-expectations/pull/326">implementing</a>
this.</p>

<p>For more info:</p>

<ul>
  <li><a href="https://relishapp.com/rspec/rspec-expectations/v/3-0/docs/syntax-configuration">Documentation</a></li>
</ul>

<h3 id="compound-matcher-expressions">Compound Matcher Expressions</h3>

<p>In RSpec 3, you can chain multiple matchers together using <code>and</code> or <code>or</code>:</p>

<pre class="highlight ruby"><code><span class="c1"># these two expectations...</span>
<span class="n">expect</span><span class="p">(</span><span class="n">alphabet</span><span class="p">).</span><span class="nf">to</span> <span class="n">start_with</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">alphabet</span><span class="p">).</span><span class="nf">to</span> <span class="n">end_with</span><span class="p">(</span><span class="s2">"z"</span><span class="p">)</span>

<span class="c1"># ...can be combined into one expression:</span>
<span class="n">expect</span><span class="p">(</span><span class="n">alphabet</span><span class="p">).</span><span class="nf">to</span> <span class="n">start_with</span><span class="p">(</span><span class="s2">"a"</span><span class="p">).</span><span class="nf">and</span> <span class="n">end_with</span><span class="p">(</span><span class="s2">"z"</span><span class="p">)</span>

<span class="c1"># You can also use `or`:</span>
<span class="n">expect</span><span class="p">(</span><span class="n">stoplight</span><span class="p">.</span><span class="nf">color</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">"red"</span><span class="p">).</span><span class="nf">or</span> <span class="n">eq</span><span class="p">(</span><span class="s2">"green"</span><span class="p">).</span><span class="nf">or</span> <span class="n">eq</span><span class="p">(</span><span class="s2">"yellow"</span><span class="p">)</span>
</code></pre>

<p>These are aliased to the <code>&amp;</code> and <code>|</code> operators:</p>

<pre class="highlight ruby"><code><span class="n">expect</span><span class="p">(</span><span class="n">alphabet</span><span class="p">).</span><span class="nf">to</span> <span class="n">start_with</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">end_with</span><span class="p">(</span><span class="s2">"z"</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">stoplight</span><span class="p">.</span><span class="nf">color</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">"red"</span><span class="p">)</span> <span class="o">|</span> <span class="n">eq</span><span class="p">(</span><span class="s2">"green"</span><span class="p">)</span> <span class="o">|</span> <span class="n">eq</span><span class="p">(</span><span class="s2">"yellow"</span><span class="p">)</span>
</code></pre>

<p>Thanks to <a href="https://github.com/eloyesp">Eloy Espinaco</a> for <a href="https://github.com/rspec/rspec-expectations/pull/329">suggesting and
implementing</a>
this feature, and to <a href="https://github.com/yelled3">Adam Farhi</a> for <a href="https://github.com/rspec/rspec-expectations/pull/537">extending
it</a> with the <code>&amp;</code> and <code>|</code> operators.</p>

<p>For more info:</p>

<ul>
  <li><a href="/blog/2014/01/new-in-rspec-3-composable-matchers#compound_matcher_expressions">New in RSpec 3: Composable Matchers</a></li>
  <li><a href="https://relishapp.com/rspec/rspec-expectations/v/3-0/docs/compound-expectations">Documentation</a></li>
</ul>

<h3 id="composable-matchers">Composable Matchers</h3>

<p>RSpec 3 allows you to expressed detailed intent by passing matchers
as arguments to other matchers:</p>

<pre class="highlight ruby"><code><span class="n">s</span> <span class="o">=</span> <span class="s2">"food"</span>
<span class="n">expect</span> <span class="p">{</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">"barn"</span> <span class="p">}.</span><span class="nf">to</span> <span class="n">change</span> <span class="p">{</span> <span class="n">s</span> <span class="p">}.</span>
  <span class="nf">from</span><span class="p">(</span> <span class="n">a_string_matching</span><span class="p">(</span><span class="sr">/foo/</span><span class="p">)</span> <span class="p">).</span>
  <span class="nf">to</span><span class="p">(</span> <span class="n">a_string_matching</span><span class="p">(</span><span class="sr">/bar/</span><span class="p">)</span> <span class="p">)</span>

<span class="n">expect</span> <span class="p">{</span> <span class="o">|</span><span class="n">probe</span><span class="o">|</span>
  <span class="s2">"food"</span><span class="p">.</span><span class="nf">tap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">probe</span><span class="p">)</span>
<span class="p">}.</span><span class="nf">to</span> <span class="n">yield_with_args</span><span class="p">(</span> <span class="n">a_string_starting_with</span><span class="p">(</span><span class="s2">"f"</span><span class="p">)</span> <span class="p">)</span>
</code></pre>

<p>For improved readability in both the code expression and failure
messages, most matchers have aliases that read properly when
passed as arguments in these sorts of expressions.</p>

<p>For more info:</p>

<ul>
  <li><a href="/blog/2014/01/new-in-rspec-3-composable-matchers">New in RSpec 3: Composable Matchers</a></li>
  <li><a href="https://github.com/rspec/rspec-expectations/issues/280">rspec-expectations #280 - original discussion</a></li>
  <li><a href="https://github.com/rspec/rspec-expectations/pull/393">rspec-expectations #393 - implementation</a></li>
  <li><a href="http://rubydoc.info/github/rspec/rspec-expectations/RSpec/Matchers">API Documentation (including list of matcher aliases)</a></li>
  <li><a href="https://relishapp.com/rspec/rspec-expectations/v/3-0/docs/composing-matchers">Relish Documentation</a></li>
</ul>

<h3 id="match-matcher-can-be-used-for-data-structures"><code>match</code> matcher can be used for data structures</h3>

<p>Before RSpec 3, the <code>match</code> matcher existed to perform string/regex
matching using the <code>#match</code> method:</p>

<pre class="highlight ruby"><code><span class="n">expect</span><span class="p">(</span><span class="s2">"food"</span><span class="p">).</span><span class="nf">to</span> <span class="n">match</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="s2">"food"</span><span class="p">).</span><span class="nf">to</span> <span class="n">match</span><span class="p">(</span><span class="sr">/foo/</span><span class="p">)</span>
</code></pre>

<p>In RSpec 3, it additionally supports matching arbitrarily nested
array/hash data structures. The expected value can be expressed
using matchers at any level of nesting:</p>

<pre class="highlight ruby"><code><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">:a</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="ss">:b</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"foo"</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="ss">:c</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:d</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="o">.</span><span class="mo">05</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">expect</span><span class="p">(</span><span class="nb">hash</span><span class="p">).</span><span class="nf">to</span> <span class="n">match</span><span class="p">(</span>
  <span class="ss">:a</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="ss">:b</span> <span class="o">=&gt;</span> <span class="n">a_collection_containing_exactly</span><span class="p">(</span>
      <span class="n">an_instance_of</span><span class="p">(</span><span class="no">Fixnum</span><span class="p">),</span>
      <span class="n">a_string_starting_with</span><span class="p">(</span><span class="s2">"f"</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="ss">:c</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:d</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">a_value</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">)</span>
</code></pre>

<p>For more info:</p>

<ul>
  <li><a href="/blog/2014/01/new-in-rspec-3-composable-matchers#match">New in RSpec 3: Composable Matchers</a></li>
</ul>

<h3 id="new-all-matcher">New <code>all</code> matcher</h3>

<p>This matcher lets you specify that something is true of all items in a
collection. Pass a matcher as an argument:</p>

<pre class="highlight ruby"><code><span class="n">expect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]).</span><span class="nf">to</span> <span class="n">all</span><span class="p">(</span> <span class="n">be_odd</span> <span class="p">)</span>
</code></pre>

<p>Thanks to <a href="https://github.com/yelled3">Adam Farhi</a> for
<a href="https://github.com/rspec/rspec-expectations/pull/491">contributing</a> this!</p>

<p>For more info:</p>

<ul>
  <li><a href="http://rubydoc.info/github/rspec/rspec-expectations/RSpec/Matchers#all-instance_method">Documentation</a></li>
</ul>

<h3 id="new-output-matcher">New <code>output</code> matcher</h3>

<p>This matcher can be used to specify that a block writes to either stdout
or stderr:</p>

<pre class="highlight ruby"><code><span class="n">expect</span> <span class="p">{</span> <span class="nb">print</span> <span class="s2">"foo"</span> <span class="p">}.</span><span class="nf">to</span> <span class="n">output</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">).</span><span class="nf">to_stdout</span>
<span class="n">expect</span> <span class="p">{</span> <span class="nb">print</span> <span class="s2">"foo"</span> <span class="p">}.</span><span class="nf">to</span> <span class="n">output</span><span class="p">(</span><span class="sr">/fo/</span><span class="p">).</span><span class="nf">to_stdout</span>
<span class="n">expect</span> <span class="p">{</span> <span class="nb">warn</span>  <span class="s2">"bar"</span> <span class="p">}.</span><span class="nf">to</span> <span class="n">output</span><span class="p">(</span><span class="sr">/bar/</span><span class="p">).</span><span class="nf">to_stderr</span>
</code></pre>

<p>Thanks to <a href="https://github.com/matthias-guenther">Matthias Günther</a> for
<a href="https://github.com/rspec/rspec-expectations/pull/399">suggesting</a> this
(and for getting the ball rolling) and <a href="https://github.com/lucapette">Luca
Pette</a> for <a href="https://github.com/rspec/rspec-expectations/pull/410">taking the feature
across the finish line</a>.</p>

<p>For more info:</p>

<ul>
  <li><a href="http://rubydoc.info/github/rspec/rspec-expectations/RSpec/Matchers#output-instance_method">Documentation</a></li>
</ul>

<h3 id="new-bebetween-matcher">New <code>be_between</code> matcher</h3>

<p>RSpec 2 provided a <code>be_between</code> matcher for objects that implement
<code>between?</code> using the dynamic predicate support. In RSpec 3, we are
gaining a first class <code>be_between</code> matcher that is better in a few ways:</p>

<ul>
  <li>The failure message is much better — rather than telling you that
<code>between?(1, 10)</code> returned false, it will tell you <code>expected 11 to be
between 1 and 10</code>.</li>
  <li>It works on objects that implement the comparison operators (e.g. <code>&lt;</code>,
<code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>) but do not implement <code>between?</code>.</li>
  <li>It provides both <code>inclusive</code> and <code>exclusive</code> modes.</li>
</ul>

<pre class="highlight ruby"><code><span class="c1"># like `Comparable#between?`, it is inclusive by default</span>
<span class="n">expect</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_between</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="c1"># ...but you can make it exclusive:</span>
<span class="n">expect</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="nf">not_to</span> <span class="n">be_between</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">).</span><span class="nf">exclusive</span>

<span class="c1"># ...or explicitly label it inclusive:</span>
<span class="n">expect</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_between</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">).</span><span class="nf">inclusive</span>
</code></pre>

<p>Thanks to <a href="https://github.com/sferik">Erik Michaels-Ober</a> for
<a href="https://github.com/rspec/rspec-expectations/pull/405">contributing</a> this and
<a href="https://github.com/pedrogimenez">Pedro Gimenez</a> for
<a href="https://github.com/rspec/rspec-expectations/pull/412">improving</a> it!</p>

<p>For more info:</p>

<ul>
  <li><a href="http://rubydoc.info/github/rspec/rspec-expectations/RSpec/Matchers#be_between-instance_method">Documentation</a></li>
</ul>

<h3 id="boolean-matchers-have-been-renamed">Boolean matchers have been renamed</h3>

<p>RSpec 2 had a pair of matchers (<code>be_true</code> and <code>be_false</code>) that mirror
Ruby's conditional semantics: <code>be_true</code> would pass for any value besides
<code>nil</code> or <code>false</code>, and <code>be_false</code> would pass for <code>nil</code> or <code>false</code>.</p>

<p>In RSpec 3, we've renamed these to <code>be_truthy</code> and <code>be_falsey</code>
(or <code>be_falsy</code>, if you prefer that spelling) to make their semantics
more explicit and to reduce confusion with <code>be true</code>/<code>be false</code>
(which read the same as <code>be_true</code>/<code>be_false</code> but only pass when given
exact <code>true</code>/<code>false</code> values).</p>

<p>Thanks to <a href="https://github.com/samphippen">Sam Phippen</a> for
<a href="https://github.com/rspec/rspec-expectations/pull/284">implementing</a>
this.</p>

<p>For more info:</p>

<ul>
  <li><a href="https://github.com/rspec/rspec-expectations/issues/283">rspec-expectations #283 - original discussion</a></li>
</ul>

<h3 id="matcharray-matcher-now-available-as-containexactly"><code>match_array</code> matcher now available as <code>contain_exactly</code></h3>

<p>RSpec has long had a matcher that allows you to match the contents of
two arrays while disregarding any ordering differences. Originally,
this was available using the <code>=~</code> operator with the old <code>should</code> syntax:</p>

<pre class="highlight ruby"><code><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">should</span> <span class="o">=~</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre>

<p>Later, when we <a href="/blog/2012/06/rspecs-new-expectation-syntax">added the <code>expect</code>
syntax</a>,
we decided not to bring the operator matchers forward to the new syntax,
and called the matcher <code>match_array</code>:</p>

<pre class="highlight ruby"><code><span class="n">expect</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]).</span><span class="nf">to</span> <span class="n">match_array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</code></pre>

<p><code>match_array</code> was the best name we could think of at the time
but we weren't super happy with it: "match" is an imprecise
term and the matcher is meant to work on other kinds of collections
besides arrays. We came up with a much better name for it
in RSpec 3:</p>

<pre class="highlight ruby"><code><span class="n">expect</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]).</span><span class="nf">to</span> <span class="n">contain_exactly</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</code></pre>

<p>Note that <code>match_array</code> is <em>not</em> deprecated. The two methods behave identically,
except that <code>contain_exactly</code> accepts the items splatted out individually,
whereas <code>match_array</code> accepts a single array argument.</p>

<p>For more info:</p>

<ul>
  <li><a href="https://relishapp.com/rspec/rspec-expectations/v/3-0/docs/built-in-matchers/contain-exactly-matcher">Documentation</a></li>
  <li><a href="https://github.com/rspec/rspec-expectations/issues/398">rspec-expectations #398 - original discussion</a></li>
  <li><a href="https://github.com/rspec/rspec-expectations/commit/6bde36e7b4ec67fcdd239cf498bebf07f661e561">Implementation</a></li>
</ul>

<h3 id="collection-cardinality-matchers-extracted-into-rspec-collectionmatchers-gem">Collection cardinality matchers extracted into <code>rspec-collection_matchers</code> gem</h3>

<p>The collection cardinality matchers — <code>have(x).items</code>,
<code>have_at_least(y).items</code> and <code>have_at_most(z).items</code> — were one of
the more "magical" and confusing parts of RSpec. They have
been <a href="https://github.com/rspec/rspec-expectations/pull/293">extracted</a> into the
<a href="https://github.com/rspec/rspec-collection_matchers">rspec-collection-matchers</a> gem, which
<a href="https://github.com/hugobarauna">Hugo Baraúna</a> has graciously volunteered to maintain.</p>

<p>The general alternative is to set an expectation on the size of
a collection:</p>

<pre class="highlight ruby"><code><span class="n">expect</span><span class="p">(</span><span class="n">list</span><span class="p">).</span><span class="nf">to</span> <span class="n">have</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nf">items</span>
<span class="c1"># ...can be written as:</span>
<span class="n">expect</span><span class="p">(</span><span class="n">list</span><span class="p">.</span><span class="nf">size</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">list</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_at_least</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nf">items</span>
<span class="c1"># ...can be written as:</span>
<span class="n">expect</span><span class="p">(</span><span class="n">list</span><span class="p">.</span><span class="nf">size</span><span class="p">).</span><span class="nf">to</span> <span class="n">be</span> <span class="o">&gt;=</span> <span class="mi">3</span>

<span class="n">expect</span><span class="p">(</span><span class="n">list</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_at_most</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nf">items</span>
<span class="c1"># ...can be written as:</span>
<span class="n">expect</span><span class="p">(</span><span class="n">list</span><span class="p">.</span><span class="nf">size</span><span class="p">).</span><span class="nf">to</span> <span class="n">be</span> <span class="o">&lt;=</span> <span class="mi">3</span>
</code></pre>

<h3 id="improved-integration-with-minitest">Improved integration with Minitest</h3>

<p>In RSpec 2.x, rspec-expectations would <a href="https://github.com/rspec/rspec-expectations/blob/v2.14.5/lib/rspec/matchers/test_unit_integration.rb">automatically include
itself</a>
in <code>MiniTest::Unit::TestCase</code> or <code>Test::Unit::TestCase</code> so that
you could use rspec-expectations from Minitest or Test::Unit simply
by loading it.</p>

<p>In RSpec 3, we've updated this integration in a couple ways:</p>

<ul>
  <li>Integration with Minitest 4 (or lower) or Test::Unit is no
longer automatic. If you use rspec-expectations in such an
environment, you'll need to <code>include RSpec::Matchers</code> yourself.</li>
  <li>Improved integration with Minitest 5 is now provided, but you
have to explicitly load it via <code>require 'rspec/expectations/minitest_integration'</code></li>
</ul>

<p>For more info:</p>

<ul>
  <li><a href="https://github.com/rspec/rspec-expectations/blob/v3.0.0.beta2/lib/rspec/expectations/minitest_integration.rb">rspec/expectations/minitest_integration.rb</a></li>
</ul>

<h3 id="changes-to-the-matcher-protocol">Changes to the matcher protocol</h3>

<p>As mentioned above, in RSpec 3, we no longer consider <code>should</code> to be
the main syntax of rspec-expectations. We've updated the matcher
protocol to reflect this:</p>

<ul>
  <li><code>failure_message_for_should</code> is now <code>failure_message</code>.</li>
  <li><code>failure_message_for_should_not</code> is now <code>failure_message_when_negated</code>.</li>
  <li><code>match_for_should</code> (an alias of <code>match</code> in the custom matcher DSL)
has been removed with no replacement. (Just use <code>match</code>).</li>
  <li><code>match_for_should_not</code> in the custom matcher DSL is now
<code>match_when_negated</code>.</li>
</ul>

<p>In addition, we've added <code>supports_block_expectations?</code> as a new, optional part
of the matcher protocol. This is used to give users clear errors when they
wrongly use a value matcher in a block expectation expression. For
example, before this change, passing a block to <code>expect</code> when using a
matcher like <code>be_nil</code> could lead to false positives:</p>

<pre class="highlight ruby"><code><span class="n">expect</span> <span class="p">{</span> <span class="n">foo</span><span class="p">.</span><span class="nf">bar</span> <span class="p">}.</span><span class="nf">not_to</span> <span class="n">be_nil</span>

<span class="c1"># ...is equivalent to:</span>
<span class="n">block</span> <span class="o">=</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="n">foo</span><span class="p">.</span><span class="nf">bar</span> <span class="p">}</span>
<span class="n">expect</span><span class="p">(</span><span class="n">block</span><span class="p">).</span><span class="nf">not_to</span> <span class="n">be_nil</span>

<span class="c1"># ...but the block is not nil (even though `foo.bar` might return nil),</span>
<span class="c1"># so the expectation will pass even though the user probably meant:</span>
<span class="n">expect</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="nf">bar</span><span class="p">).</span><span class="nf">not_to</span> <span class="n">be_nil</span>
</code></pre>

<p>Note that <code>supports_block_expectations?</code> is an optional part of the
protocol. For matchers that are not intended to be used in block
expectation expressions, you do not need to define it.</p>

<p>For more info:</p>

<ul>
  <li><a href="https://github.com/rspec/rspec-expectations/issues/270">rspec-expectations #270 - original discussion</a></li>
  <li><a href="https://github.com/rspec/rspec-expectations/pull/373">rspec-expectations #373 - implementation</a></li>
  <li><a href="https://github.com/rspec/rspec-expectations/issues/526">rspec-expectations #530 - original discussion of <code>supports_block_expectations?</code></a></li>
  <li><a href="https://github.com/rspec/rspec-expectations/pull/530">rspec-expectations #530 - implementation of <code>supports_block_expectations?</code></a></li>
</ul>

<h2 id="rspec-mocks">rspec-mocks</h2>

<h3 id="using-the-monkey-patched-syntax-without-explicitly-enabling-it-is-deprecated">Using the monkey-patched syntax without explicitly enabling it is deprecated</h3>

<p>As with rspec-expectations, we've been moving rspec-mocks towards a
zero-monkey patching syntax. This was <a href="http://teaisaweso.me/blog/2013/05/27/rspecs-new-message-expectation-syntax/">originally
introduced</a>
in 2.14. In RSpec 3, you'll get a deprecation warning if you use the
original syntax (e.g. <code>obj.stub</code>, <code>obj.should_receive</code>, etc) without
explicitly enabling it (just like with rspec-expectations' new syntax).</p>

<p>Thanks to <a href="https://github.com/samphippen">Sam Phippen</a> for
<a href="https://github.com/rspec/rspec-mocks/pull/339">implementing</a>
this.</p>

<h3 id="receivemessages-and-receivemessagechain-for-the-new-syntax"><code>receive_messages</code> and <code>receive_message_chain</code> for the new syntax</h3>

<p>The original monkey patching syntax had some features that the
new syntax, as released in 2.14, lacked. We've addressed that
in RSpec 3 via a couple new APIs: <code>receive_messages</code> and
<code>receive_message_chain</code>.</p>

<pre class="highlight ruby"><code><span class="c1"># old syntax:</span>
<span class="n">object</span><span class="p">.</span><span class="nf">stub</span><span class="p">(</span><span class="ss">:foo</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">:bar</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># new syntax:</span>
<span class="n">allow</span><span class="p">(</span><span class="n">object</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive_messages</span><span class="p">(</span><span class="ss">:foo</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">:bar</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># old syntax:</span>
<span class="n">object</span><span class="p">.</span><span class="nf">stub_chain</span><span class="p">(</span><span class="ss">:foo</span><span class="p">,</span> <span class="ss">:bar</span><span class="p">,</span> <span class="ss">:bazz</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># new syntax:</span>
<span class="n">allow</span><span class="p">(</span><span class="n">object</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive_message_chain</span><span class="p">(</span><span class="ss">:foo</span><span class="p">,</span> <span class="ss">:bar</span><span class="p">,</span> <span class="ss">:bazz</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre>

<p>One nice benefit of these new APIs is that they work with <code>expect</code>, too,
whereas there was no message expectation equivalent of <code>stub(hash)</code> or
<code>stub_chain</code> in the old syntax.</p>

<p>Thanks to <a href="https://github.com/JonRowe">Jon Rowe</a> and
<a href="https://github.com/samphippen">Sam Phippen</a> for implementing this.</p>

<p>For more info:</p>

<ul>
  <li><a href="http://rubydoc.info/github/rspec/rspec-mocks/RSpec/Mocks/ExampleMethods#receive_messages-instance_method">Documentation for <code>receive_messages</code></a></li>
  <li><a href="http://rubydoc.info/github/rspec/rspec-mocks/RSpec/Mocks/ExampleMethods#receive_message_chain-instance_method">Documentation for
<code>receive_message_chain</code></a></li>
  <li><a href="https://github.com/rspec/rspec-mocks/issues/368">rspec-mocks #368 - discussion of <code>receive_messages</code></a></li>
  <li><a href="https://github.com/rspec/rspec-mocks/pull/399">rspec-mocks #399 - implementation of <code>receive_messages</code></a></li>
  <li><a href="https://github.com/rspec/rspec-mocks/issues/464">rspec-mocks #464 - discussion of <code>receive_message_chain</code></a></li>
  <li><a href="https://github.com/rspec/rspec-mocks/pull/467">rspec-mocks #467 - implementation of <code>receive_message_chain</code></a></li>
</ul>

<h3 id="removed-mock-and-stub-aliases-of-double">Removed <code>mock</code> and <code>stub</code> aliases of <code>double</code></h3>

<p>Historically, rspec-mocks has provided 3 methods for creating
a test double: <code>mock</code>, <code>stub</code> and <code>double</code>. In RSpec 3, we've
removed <code>mock</code> and <code>stub</code> in favor of just <code>double</code>, and built
out more features that use the <code>double</code> nomenclature (such as
verifying doubles — see below).</p>

<p>Of course, while RSpec 3 no longer provides <code>mock</code> and <code>stub</code>
aliases of <code>double</code>, it's easy to define these aliases on your
own if you'd like to keep using them:</p>

<pre class="highlight ruby"><code><span class="c1"># spec/spec_helper.rb</span>
<span class="k">module</span> <span class="nn">DoubleAliases</span>
  <span class="k">def</span> <span class="nf">mock</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
    <span class="n">double</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="k">alias</span> <span class="n">stub</span> <span class="n">mock</span>
<span class="k">end</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">include</span> <span class="no">DoubleAliases</span>
<span class="k">end</span>
</code></pre>

<p>Thanks to <a href="https://github.com/samphippen">Sam Phippen</a> for
<a href="https://github.com/rspec/rspec-mocks/pull/341">implementation</a>
this.</p>

<p>For more info:</p>

<ul>
  <li><a href="https://gist.github.com/myronmarston/6576665">Explanation for why we made this change</a></li>
</ul>

<h3 id="verifying-doubles">Verifying doubles</h3>

<p>A new type of double has been added that ensures you only stub or mock methods
that actually exist, and that passed arguments conform to the declared method
signature. The <code>instance_double</code>, <code>class_double</code>, and <code>object_double</code> doubles
will all raise an exception if those conditions aren't met. If the class has
not been loaded (usually when running a unit test in isolation), then no
exceptions will be raised.</p>

<p>This is a subtle behaviour, but very powerful since it allows the speed of
isolated unit tests with the confidence closer to that of an integration test
(or a type system). There is rarely a reason not to use these new more powerful
double types.</p>

<p>Thanks to <a href="http://xaviershay.com">Xavier Shay</a> for the idea and implementation
of this feature.</p>

<p>For more info:</p>

<ul>
  <li><a href="http://rhnh.net/2013/12/10/new-in-rspec-3-verifying-doubles">Blog post on motivation and uses</a></li>
  <li><a href="https://relishapp.com/rspec/rspec-mocks/v/3-0/docs/verifying-doubles">Documentation</a></li>
</ul>

<h3 id="partial-double-verification-configuration-option">Partial double verification configuration option</h3>

<p>Verifying double behaviour can also be <a href="https://relishapp.com/rspec/rspec-mocks/v/3-0/docs/verifying-doubles/partial-doubles">enabled globally on partial
doubles</a>.
(A partial double is when you mock or stub an existing object:
<code>expect(MyClass).to receive(:some_message)</code>.)</p>

<pre class="highlight ruby"><code><span class="c1"># spec/spec_helper.rb</span>
<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">mock_with</span> <span class="ss">:rspec</span> <span class="k">do</span> <span class="o">|</span><span class="n">mocks</span><span class="o">|</span>
    <span class="n">mocks</span><span class="p">.</span><span class="nf">verify_partial_doubles</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>We recommend you enable this option for all new code.</p>

<h3 id="scoping-changes">Scoping changes</h3>

<p>rspec-mocks's operations are designed with a per-test lifecycle in mind.
This was documented in RSpec 2, but was not always explicitly enforced
at runtime, and we sometimes got bug reports from users when they tried
to use features of rspec-mocks outside of the per-test lifecycle.</p>

<p>In RSpec 3, we've tightened this up and this lifecycle is enforced
explicitly at runtime:</p>

<ul>
  <li>Usage of rspec-mocks features from a <code>before(:context)</code> hook (or in any
other context when there is not a current example) is not supported.</li>
  <li>Test doubles are only usable for one example. If you attempt to use
a test double outside of the example in which it originated (e.g. by
accidentally assigning it to a class attribute and then using it in
a later example), you will get explicit errors.</li>
</ul>

<p>We've also provided a new API that lets you create temporary scopes in
arbitrary places (such as a <code>before(:context)</code> hook):</p>

<pre class="highlight ruby"><code><span class="n">describe</span> <span class="no">MyWebCrawler</span> <span class="k">do</span>
  <span class="n">before</span><span class="p">(</span><span class="ss">:context</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">RSpec</span><span class="o">::</span><span class="no">Mocks</span><span class="p">.</span><span class="nf">with_temporary_scope</span> <span class="k">do</span>
      <span class="n">allow</span><span class="p">(</span><span class="no">MyWebCrawler</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:crawl_depth_limit</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
      <span class="vi">@crawl_results</span> <span class="o">=</span> <span class="no">MyWebCrawler</span><span class="p">.</span><span class="nf">perform_crawl_on</span><span class="p">(</span><span class="s2">"http://some-host.com/"</span><span class="p">)</span>
    <span class="k">end</span> <span class="c1"># verification and resets happen when the block completes</span>
  <span class="k">end</span>

  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>

<p>Thanks to <a href="https://github.com/samphippen">Sam Phippen</a> for helping with
<a href="https://github.com/rspec/rspec-mocks/pull/449">implementing</a> these changes,
and <a href="https://github.com/skalee">Sebastian Skałacki</a> for suggesting the new
<code>with_temporary_scope</code> feature.</p>

<p>For more info:</p>

<ul>
  <li><a href="https://github.com/rspec/rspec-mocks/issues/240">rspec-mocks #240 - original discussion</a></li>
  <li><a href="https://github.com/rspec/rspec-mocks/pull/519">rspec-mocks #519 - <code>with_temporary_scope</code> implementation</a></li>
</ul>

<h3 id="anyinstance-implementation-blocks-yield-the-receiver"><code>any_instance</code> implementation blocks yield the receiver</h3>

<p>When providing an implementation block for a method stub it can be
useful to do some calculation based on the state of the object.
Unfortunately, there wasn't a simple way to do this when using
<code>any_instance</code> in RSpec 2. In RSpec 3, the receiver is yielded
as the first argument to an <code>any_instance</code> implementation block,
making this easy:</p>

<pre class="highlight ruby"><code><span class="n">allow_any_instance_of</span><span class="p">(</span><span class="no">Employee</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:salary</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">employee</span><span class="p">,</span> <span class="n">currency</span><span class="o">|</span>
  <span class="n">usd_amount</span> <span class="o">=</span> <span class="mi">50_000</span> <span class="o">+</span> <span class="p">(</span><span class="mi">10_000</span> <span class="o">*</span> <span class="n">employee</span><span class="p">.</span><span class="nf">years_worked</span><span class="p">)</span>
  <span class="n">currency</span><span class="p">.</span><span class="nf">from_usd</span><span class="p">(</span><span class="n">usd_amount</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">employee</span> <span class="o">=</span> <span class="no">Employee</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span>
<span class="n">salary</span> <span class="o">=</span> <span class="n">employee</span><span class="p">.</span><span class="nf">salary</span><span class="p">(</span><span class="no">Currency</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="ss">:CAD</span><span class="p">))</span>
</code></pre>

<p>Thanks to <a href="https://github.com/samphippen">Sam Phippen</a> for
<a href="https://github.com/rspec/rspec-mocks/pull/351">implementing</a> this.</p>

<p>For more info:</p>

<ul>
  <li><a href="https://github.com/rspec/rspec-mocks/issues/175">rspec-mocks #175 - original discussion</a></li>
</ul>

<h2 id="rspec-rails">rspec-rails</h2>

<h3 id="file-type-inference-disabled-by-default">File-type inference disabled by default</h3>

<p>rspec-rails automatically adds metadata to specs based on their location on the
filesystem. This is confusing to new users, and not desirable for some veteran
users.</p>

<p>In RSpec 3, this behavior must be explicitly enabled:</p>

<pre class="highlight ruby"><code><span class="c1"># spec/spec_helper.rb</span>
<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">infer_spec_type_from_file_location!</span>
<span class="k">end</span>
</code></pre>

<p>Since this assumed behavior is so prevalent in tutorials, the default generated
configuration still enables this.</p>

<p>To explicitly tag specs without using automatic inference, set the <code>type</code>
metadata:</p>

<pre class="highlight ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">ThingsController</span><span class="p">,</span> <span class="ss">type: :controller</span> <span class="k">do</span>
  <span class="c1"># Equivalent to being in spec/controllers</span>
<span class="k">end</span>
</code></pre>

<p>The different available types are documented in each of the different spec
types, for instance <a href="https://relishapp.com/rspec/rspec-rails/v/3-0/docs/controller-specs">documentation for controller
specs</a>.</p>

<p>For more info:</p>

<ul>
  <li><a href="https://github.com/rspec/rspec-rails/issues/662">rspec-rails #662 - original discussion</a></li>
  <li><a href="https://github.com/rspec/rspec-rails/pull/970">rspec-rails #970 - implementation</a></li>
</ul>

<h3 id="extracted-activemodel-mocks-support">Extracted activemodel mocks support</h3>

<p><code>mock_model</code> and <code>stub_model</code> have been extracted into the <a href="https://github.com/rspec/rspec-activemodel-mocks">rspec-activemodel-mocks
gem</a>.</p>

<p>Thanks to <a href="https://github.com/thomas-holmes">Thomas Holmes</a> for doing the
extraction and for offering to maintain the new gem.</p>

<h3 id="dropped-webrat-support">Dropped webrat support</h3>

<p>Webrat support has been removed. Use capybara instead.</p>

<h3 id="anonymous-controller-improvements">Anonymous controller improvements</h3>

<p>rspec-rails has long allowed you to create anonymous controllers for testing.
In RSpec 3 they have received some improvements:</p>

<ul>
  <li>By default they will inherit from the described class rather than
<code>AppplicationController</code>. This behaviour can be disabled with the
<code>infer_base_class_for_anonymous_controllers</code> configuration option.</li>
  <li>Many bugfixes when using in "non-standard" contexts, such as with abstract
parents or with no <code>ApplicationController</code>. If you have had issues with
anonymous controllers in the past, now would be a good time to try them
again.</li>
</ul>

<p>For more info:</p>

<ul>
  <li><a href="https://relishapp.com/rspec/rspec-rails/v/3-0/docs/controller-specs/anonymous-controller">Documentation - Anonymous controllers</a></li>
  <li><a href="https://github.com/rspec/rspec-rails/pull/893">rspec-rails #893 - Enable infering base class by default</a></li>
  <li><a href="https://github.com/rspec/rspec-rails/pull/905">rspec-rails #905 - Fix anonymous controller route helpers</a></li>
  <li><a href="https://github.com/rspec/rspec-rails/pull/924">rspec-rails #924 - Don't assume presence of ApplicationController</a></li>
</ul>

<h2 id="final-words">Final words</h2>

<p>As always, full changelogs are available for each for the subprojects:</p>

<ul>
  <li><a href="https://github.com/rspec/rspec-core/blob/master/Changelog.md">rspec-core</a></li>
  <li><a href="https://github.com/rspec/rspec-expectations/blob/master/Changelog.md">rspec-expectations</a></li>
  <li><a href="https://github.com/rspec/rspec-mocks/blob/master/Changelog.md">rspec-mocks</a></li>
  <li><a href="https://github.com/rspec/rspec-rails/blob/master/Changelog.md">rspec-rails</a></li>
</ul>

<p>RSpec 3 is the first major release of RSpec in nearly 4 years. It
represents a huge amount of work from a large number of contributors.</p>

<p>We hope you like the new changes as much as we do, no matter how you use RSpec.</p>

<p><em>Thanks to Xavier Shay for helping write this blog post and to Jon Rowe,
Sam Phippen and Aaron Kromer for proofreading it.</em></p>

<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname  = 'myronmarston-personal-site';
  var disqus_identifier = '/n/dev-blog/2014/05/notable-changes-in-rspec-3';
  var disqus_title      = 'Notable Changes in RSpec 3';
  var disqus_url        = 'http://myronmars.to/n/dev-blog/2014/05/notable-changes-in-rspec-3';

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</article></section><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59095215-1', 'auto');
  ga('send', 'pageview');

</script>
</body></html>